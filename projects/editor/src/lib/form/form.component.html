<editor-sidebar
    class="left"
    [class.hidden]="!showSidebars"
    [position]="typeOfSideBarPosition.LEFT"
    (resizeEnd)="onResizeEnd()"
>
    <editor-sidebar-section>
        <span headerContent>Fields</span>
        <div
            class="tree-container"
            mainContent
        >
            <ng-container *ngIf="(formFields$ | async)?.length; else addFieldText">
                <editor-field-tree-item
                    *ngFor="let field of fields$ | async"
                    [field]="field"
                    [isExpanded]="true"
                >
                </editor-field-tree-item>
            </ng-container>
        </div>
    </editor-sidebar-section>
</editor-sidebar>

<div class="main">
    <editor-toolbar
        class="toolbar"
        [(tabIndex)]="toolbarTabIndex"
        [isEditMode]="isEditMode$ | async"
        (isEditModeChange)="onEditModeChanged($event)"
        (resetModel)="onResetModel()"
        (duplicateForm)="onDuplicateForm()"
        (exportForm)="onExportForm()"
        (toggleSidebars)="showSidebars = $event"
    >
    </editor-toolbar>
    <mat-tab-group
        class="tab-group"
        *ngIf="(formFields$ | async)?.length; else addFieldButton"
        [selectedIndex]="toolbarTabIndex"
    >
        <mat-tab>
            <editor-formly-form
                [fields]="formFields$ | async"
                [model]="model$ | async"
                [form]="formGroup"
                [options]="options"
                (modelChange)="onFormModelChanged($event)"
            >
            </editor-formly-form>
        </mat-tab>
        <mat-tab>
            <pre><code>{{ formFieldsJSON$ | async }}</code></pre>
        </mat-tab>
    </mat-tab-group>
</div>

<editor-sidebar
    class="right"
    [class.hidden]="!showSidebars"
    [position]="typeOfSideBarPosition.RIGHT"
    (resizeEnd)="onResizeEnd()"
>
    <editor-sidebar-section class="active-field-section">
        <span headerContent>
            Active Field
            <span *ngIf="activeField$ | async as activeField">
                - {{ activeField._info.name | fieldName : activeField.key }}
            </span>
        </span>
        <editor-edit-field
            *ngIf="activeField$ | async; else addFieldText"
            mainContent
            [field$]="activeField$"
            [isSimplified]="!isAdvanced"
            [resizeTabHeader$]="resizeEnd$"
            (fieldChanged)="onActiveFieldChanged($event)"
        >
        </editor-edit-field>
    </editor-sidebar-section>

    <editor-sidebar-section>
        <div
            class="model-header-content"
            headerContent
        >
            <span>Model</span>
            <button
                mat-icon-button
                [matMenuTriggerFor]="modelOptionsMenu"
            >
                <mat-icon>more_vert</mat-icon>
            </button>
        </div>

        <div
            class="tree-container"
            mainContent
        >
            <editor-object-property
                [target]="model$ | async"
                [property]="modelProperty"
                [isExpanded]="true"
                (targetChanged)="onModelChanged($event)"
            >
            </editor-object-property>
        </div>
    </editor-sidebar-section>
</editor-sidebar>

<ng-template #addFieldText>
    <div class="no-fields-wrapper">No Field</div>
</ng-template>

<ng-template #addFieldButton>
    <div class="no-fields-wrapper">
        <button
            mat-flat-button
            color="primary"
            [matMenuTriggerFor]="addCategoryMenu"
        >
            <mat-icon>add</mat-icon>
            Add Field
        </button>
    </div>
</ng-template>

<mat-menu #addCategoryMenu="matMenu">
    <ng-container *ngFor="let category of editorService.fieldCategories">
        <button
            mat-menu-item
            [matMenuTriggerFor]="addFieldMenu"
        >
            {{ category.name }}
        </button>

        <mat-menu #addFieldMenu="matMenu">
            <button
                mat-menu-item
                *ngFor="let option of category.typeOptions"
                (click)="onAddInitialField(option.name, option.customName)"
            >
                {{ option.displayName }}
            </button>
        </mat-menu>
    </ng-container>
</mat-menu>

<mat-menu #modelOptionsMenu="matMenu">
    <button
        mat-menu-item
        (click)="onImportModel()"
    >
        <mat-icon>file_download</mat-icon>
        <span>Import</span>
    </button>
    <button
        mat-menu-item
        (click)="onExportModel()"
    >
        <mat-icon>file_upload</mat-icon>
        <span>Export</span>
    </button>
</mat-menu>
