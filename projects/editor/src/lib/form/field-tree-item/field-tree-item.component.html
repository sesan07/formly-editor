<editor-tree-item
    class="cursor-pointer"
    [treeLevel]="treeLevel"
    [(isExpanded)]="isExpanded"
    [isExpandable]="fieldInfo.canHaveChildren"
    [isActive]="isActiveField"
    [hasOptions]="hasOptions"
    [optionsMenu]="optionsMenu"
    (isExpandedChange)="onSelected()"
>
    <ng-container headerContent>{{ getFormattedFieldName(field) }}</ng-container>

    <ng-container childrenContent>
        <editor-field-tree-item
            *ngFor="let child of childFields; trackBy: trackFieldById"
            [field]="child"
            [treeLevel]="treeLevel + 1"
            (remove)="onRemoveChildField(child)"
            (expandParent)="onExpandParent()"
        >
        </editor-field-tree-item>
    </ng-container>
</editor-tree-item>

<mat-menu #optionsMenu="matMenu">
    <button
        *ngIf="fieldInfo.canHaveChildren"
        mat-menu-item
        [matMenuTriggerFor]="addCategoryMenu"
    >
        <mat-icon>add</mat-icon>
        <span>Add</span>
    </button>
    <button
        *ngIf="fieldInfo.canHaveChildren && replaceCategories.length > 0"
        mat-menu-item
        [matMenuTriggerFor]="replaceCategoryMenu"
    >
        <mat-icon>sync</mat-icon>
        <span>Replace</span>
    </button>
    <button
        *ngIf="treeLevel !== 0"
        mat-menu-item
        (click)="remove.emit()"
    >
        <mat-icon>remove</mat-icon>
        <span>Remove</span>
    </button>
</mat-menu>

<mat-menu #addCategoryMenu="matMenu">
    <ng-container *ngFor="let category of editorService.fieldCategories">
        <button
            mat-menu-item
            [matMenuTriggerFor]="addFieldMenu"
        >
            {{ category.name }}
        </button>

        <mat-menu #addFieldMenu="matMenu">
            <button
                mat-menu-item
                *ngFor="let option of category.typeOptions"
                (click)="onAddChildField(option.name, option.customName)"
            >
                {{ option.displayName }}
            </button>
        </mat-menu>
    </ng-container>
</mat-menu>

<mat-menu #replaceCategoryMenu="matMenu">
    <ng-container *ngFor="let category of replaceCategories">
        <button
            mat-menu-item
            [matMenuTriggerFor]="replaceFieldMenu"
        >
            {{ category.name }}
        </button>

        <mat-menu #replaceFieldMenu="matMenu">
            <button
                mat-menu-item
                *ngFor="let option of category.typeOptions"
                (click)="onReplaceParentField(option.name, option.customName)"
            >
                {{ option.displayName }}
            </button>
        </mat-menu>
    </ng-container>
</mat-menu>
