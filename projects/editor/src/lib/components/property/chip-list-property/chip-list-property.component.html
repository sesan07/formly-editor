<div class="tree-item-header" *ngIf="!isSimplified else simplifiedView">
	<span class="tree-item-header-content-left">
		<button mat-icon-button [matMenuTriggerFor]="optionsMenu" [disabled]="!hasOptions">
			<mat-icon>more_vert</mat-icon>
		</button>
			
		<mat-menu #optionsMenu="matMenu">
			<button *ngIf="property.isDeletable" mat-menu-item color="warn" (click)="remove.emit()">
				<mat-icon>remove</mat-icon>
				<span>Remove</span>
			</button>
		</mat-menu>
	
		<!-- use a disabled button to provide padding for non expandable field -->
		<button [style.margin-left.px]="treeLevelPadding" mat-icon-button [disabled]="true"></button>
		<span #key class="keyField" [ngClass]="{ 'editable': !!property.isKeyEditable }" [contentEditable]="!!property.isKeyEditable"></span>
		<span>:</span>
	</span>
	
	<div class="tree-item-header-content-right">
        <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ appearance: 'outline' }"></ng-container>
	</div>
</div>

<ng-template #simplifiedView>
    <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ showLabel: true }"></ng-container>
</ng-template>

<ng-template #formField let-appearance="appearance" let-showLabel="showLabel">
    <mat-form-field [appearance]="appearance">
        <mat-label *ngIf="showLabel">{{ property.name ? property.name : property.key }}</mat-label>
        <mat-chip-list #chipList>
            <ng-container *ngFor="let option of selectedOptions">
                <mat-chip *ngIf="!isHidden(option)"
                            selectable
                            (removed)="onRemove(option)">
                    {{option}}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </ng-container>
            <input #input
                    [formControl]="formControl"
                    [placeholder]="'start typing...'"
                    [matAutocomplete]="autoComplete"
                    [matChipInputFor]="chipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                    (matChipInputTokenEnd)="onAdd($event)">
        </mat-chip-list>
        <mat-autocomplete #autoComplete="matAutocomplete" (optionSelected)="onSelected($event)">
            <mat-option *ngFor="let option of filteredOptions | async"
                        [value]="option">
                {{option}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
</ng-template>
