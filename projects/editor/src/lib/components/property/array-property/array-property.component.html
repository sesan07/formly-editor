<div class="tree-item-header" *ngIf="!isSimplified else simplifiedView">
	<span class="tree-item-header-content-left">
		<button mat-icon-button [matMenuTriggerFor]="optionsMenu" [disabled]="!hasOptions">
			<mat-icon>more_vert</mat-icon>
		</button>
		
		<mat-menu #optionsMenu="matMenu">
			<button *ngIf="property.canAdd" mat-menu-item (click)="onAddChild()">
				<mat-icon>add</mat-icon>
				<span>Add {{ property.childProperty.type }}</span>
			</button>
			<button *ngIf="property.isDeletable" mat-menu-item (click)="remove.emit()">
				<mat-icon>remove</mat-icon>
				<span>Remove</span>
			</button>
		</mat-menu>
		
		<button [style.margin-left.px]="treeLevelPadding" mat-icon-button (click)="isExpanded = !isExpanded">
			<mat-icon class="expand-icon" [class.expanded-90]="isExpanded">chevron_right</mat-icon>
		</button>
		<span #key class="keyField" [ngClass]="{ 'editable': !!property.isKeyEditable }" [contentEditable]="!!property.isKeyEditable"></span>
		<span>{{ '[ ' + target.length + ' ]' }}</span>
	</span>
</div>

<ng-container *ngIf="!isSimplified">
    <ng-container *ngTemplateOutlet="childPropertiesView"></ng-container>
</ng-container>

<ng-template #simplifiedView>
    <div class="simplified-header" (click)="isExpanded = !isExpanded">
            <span class="simplified-header-left">
                <button mat-icon-button (click)="isExpanded = !isExpanded; $event.stopPropagation()">
                    <mat-icon class="expand-icon" [class.expanded-90]="isExpanded">chevron_right</mat-icon>
                </button>
                <span>{{ property.name ? property.name : property.key + ' [ ' + target.length + ' ]' }}</span>
            </span>
            
            <button *ngIf="property.canAdd" mat-icon-button (click)="onAddChild(); $event.stopPropagation()">
                <mat-icon>add</mat-icon>
            </button>
    </div>
    <div class="simplified-properties">
        <ng-container *ngTemplateOutlet="childPropertiesView"></ng-container>
    </div>
</ng-template>

<ng-template #childPropertiesView>
    <ng-container *ngIf="isExpanded">
        <ng-container *ngFor="let childProperty of childProperties; let i = index; let last = last; trackBy: trackPropertyByKey">
            <lib-property
                [treeLevel]="treeLevel + 1"
                [path]="getChildPath(childProperty.key)"
                [target]="target"
                [property]="childProperty"
                [isSimplified]="isSimplified"
                (remove)="onRemoveChild(i)"
                (valueChanged)="onValueChanged($event)">
            </lib-property>
            <mat-divider *ngIf="isSimplified && !last"></mat-divider>
        </ng-container>
        <button *ngIf="property.canAdd" [style.margin-left.px]="isSimplified ? 0 : addButtonPadding" mat-button (click)="onAddChild()">
            <mat-icon>add</mat-icon>
            <span>Add</span>
        </button>
    </ng-container>
</ng-template>
