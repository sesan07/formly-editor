<div class="tree-item-header" *ngIf="!isSimplified">
	<span class="tree-item-header-content-left">
		<button mat-icon-button [ngStyle]="{'margin-right.px': treeLevelPadding}" [matMenuTriggerFor]="optionsMenu" [disabled]="!hasOptions">
			<mat-icon>more_vert</mat-icon>
		</button>
		
		<mat-menu #optionsMenu="matMenu">
			<button *ngIf="property?.addOptions?.length > 0" mat-menu-item [matMenuTriggerFor]="addMenu">
				<mat-icon>add</mat-icon>
				<span>Add</span>
			</button>
			<button *ngIf="property?.isDeletable" mat-menu-item color="warn" (click)="remove.emit()">
				<mat-icon>remove</mat-icon>
				<span>Remove</span>
			</button>
		</mat-menu>

		<mat-menu #addMenu="matMenu">
			<button mat-menu-item *ngIf="property.addOptions?.includes(propertyType.ARRAY)" [matMenuTriggerFor]="addArrayMenu">
				{{propertyType.ARRAY}}
			</button>
			<ng-container *ngFor="let type of propertyService.possibleArrayAddTypes">
				<button mat-menu-item *ngIf="property.addOptions?.includes(type)" (click)="onAddChild(type)">
					{{type}}
				</button>
			</ng-container>
		</mat-menu>

		<mat-menu #addArrayMenu="matMenu">
			<button *ngFor="let type of propertyService.possibleArrayAddTypes" mat-menu-item (click)="onAddChild(propertyType.ARRAY, type)">
				{{type}}
			</button>
		</mat-menu>

		<button mat-icon-button (click)="isExpanded = !isExpanded">
			<mat-icon class="expand-icon" [class.expanded-90]="isExpanded">chevron_right</mat-icon>
		</button>
		<span #key class="keyField" [ngClass]="{ 'editable': !!property?.isKeyEditable }" [contentEditable]="!!property?.isKeyEditable"></span>
		<span>{{ (property?.name ? '(' + property.name + ') ' : '') + '{ ' + property.childProperties.length + ' }' }}</span>
	</span>
</div>

<ng-container *ngIf="!isSimplified && isExpanded">
    <ng-container *ngTemplateOutlet="childPropertiesView"></ng-container>
</ng-container>

<div class="simplified-container" *ngIf="isSimplified">
    <div class="simplified-properties">
        <ng-container *ngTemplateOutlet="childPropertiesView"></ng-container>
    </div>
    <button *ngIf="property?.isDeletable" mat-icon-button color="warn" (click)="remove.emit()">
        <mat-icon>remove</mat-icon>
    </button>
</div>

<ng-template #childPropertiesView>
	<ng-container *ngFor="let child of property.childProperties; let i = index; trackBy: trackPropertyByKey">
        <lib-property
            *ngIf="isSimplified ? child.isSimple : true"
            [treeLevel]="treeLevel + 1"
            [target]="target"
            [property]="child"
            [isSimplified]="isSimplified"
            (remove)="onRemoveChild(i)"
            (valueChanged)="onValueChanged()">
        </lib-property>
	</ng-container>
</ng-template>
