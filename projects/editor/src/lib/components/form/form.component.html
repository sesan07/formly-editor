<lib-sidebar
    class="left"
    [class.hidden]="!showSidebars"
    [position]="typeOfSideBarPosition.LEFT"
    (resizeEnd)="onResizeEnd()"
    >
    <lib-sidebar-section>
		<span headerContent>Fields</span>
        <div class="tree-container" mainContent>
            <lib-field-tree-item
                *ngFor="let field of form.fields"
                [field]="field"
                [isExpanded]="true">
            </lib-field-tree-item>
        </div>
	</lib-sidebar-section>
	<lib-sidebar-section>
		<span headerContent>Add Field</span>
        <div class="categories-wrapper" mainContent>
            <lib-field-category-list
                *ngFor="let category of editorService.fieldCategories; let first = first"
                [category]="category"
                [formId]="form.id"
                [isExpanded]="first">
            </lib-field-category-list>
        </div>
	</lib-sidebar-section>
</lib-sidebar>

<div class="main">
    <lib-form-toolbar
        class="toolbar"
        [(selectedDisplay)]="selectedFormDisplay"
        (resetModel)="onResetModel()"
        (toggleSidebars)="showSidebars = $event">
    </lib-form-toolbar>
    <mat-tab-group class="tab-group" [selectedIndex]="formDisplayTabIndex">
        <mat-tab>
            <lib-editor-formly-form
                [form]="formGroup"
                [fields]="fields"
                [model]="formModel"
                [options]="options"
                (modelChange)="onModelChanged($event)">
            </lib-editor-formly-form>
        </mat-tab>
        <mat-tab>
            <pre><code>{{ fieldsJSON }}</code></pre>
        </mat-tab>
    </mat-tab-group>
</div>

<lib-sidebar
    class="right"
    [class.hidden]="!showSidebars"
    [position]="typeOfSideBarPosition.RIGHT"
    (resizeEnd)="onResizeEnd()"
    >
	<lib-sidebar-section class="active-field-section">
        <div class="header-content" headerContent>
            <span>Active Field - {{ editorService.getFormattedFieldName(form.activeField.name, form.activeField.key) }}</span>
            <mat-slide-toggle labelPosition="before" [(ngModel)]="isAdvanced">Advanced</mat-slide-toggle>
        </div>
        <lib-edit-field
            mainContent
            [field]="form.activeField"
            [property]="activeFieldProperty"
            [isSimplified]="!isAdvanced"
            [resizeTabHeader$]="resizeEnd$"
            (fieldChanged)="onActiveFieldChanged()">
        </lib-edit-field>
	</lib-sidebar-section>

	<lib-sidebar-section>
        <div class="header-content" headerContent>
            <span>Model</span>
            <button mat-icon-button [matMenuTriggerFor]="modelOptionsMenu">
                <mat-icon>more_vert</mat-icon>
            </button>
        </div>
        
        <div class="tree-container" mainContent>
            <lib-object-property
                [target]="form.model"
                [property]="modelProperty"
                [isExpanded]="true"
                [isRoot]="true"
                (targetChanged)="onModelPropertyChanged()">
            </lib-object-property>
        </div>
	</lib-sidebar-section>
</lib-sidebar>

<mat-menu #modelOptionsMenu="matMenu">
	<button mat-menu-item (click)="onImportModel()">
		<mat-icon>file_download</mat-icon>
		<span>Import</span>
	</button>
	<button mat-menu-item (click)="onExportModel()">
		<mat-icon>file_upload</mat-icon>
		<span>Export</span>
	</button>
</mat-menu>
